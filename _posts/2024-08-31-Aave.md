---
title: "Aave's zkSync Hiccup and Immunefi's $16M Reality Check"
date: 2024-08-31
categories: [Blockchain Security, DeFi, zkSync, Aave, Immunefi]
---

## üß† Overview

August ended with two stories that perfectly capture the current state of DeFi security: Aave discovering that compiler bugs can break multi-million dollar protocols, and Immunefi's CEO reminding everyone that the average hack costs $16 million plus destroyed reputation. Both incidents highlight why deploying on cutting-edge infrastructure requires paranoid-level testing.

What's particularly interesting about the Aave incident is that it wasn't their code that was wrong ‚Äî it was the LLVM compiler that zkSync uses. This creates a fascinating new attack surface where perfectly audited smart contracts can still behave unpredictably due to compilation issues.

---

## üîç Aave v3 zkSync Activation Issue

### Incident Overview

On 21 August, during the final activation phase of Aave v3 on zkSync, an unexpected behavior was detected. The issue was traced to a bug in the LLVM compiler, a widely used dependency in the zkSync Era compiler. This bug affected a specific logic expression in Aave's smart contracts, leading to discrepancies in asset balances and UI inconsistencies.


```solidity
// This worked fine on Ethereum mainnet
function calculateUserBalance(address user) external view returns (uint256) {
    // Complex balance calculation logic
    uint256 supplied = userSupplies[user];
    uint256 borrowed = userBorrows[user];
    
    // LLVM compiler bug affected this specific expression pattern
    return (supplied * exchangeRate) - (borrowed * borrowRate);
}

// But zkSync compilation produced incorrect results
```


### Outcome

No funds were at risk during this incident, and the Aave v3 zkSync pool was successfully activated after the issue was resolved. This event underscores the importance of thorough testing and the need for robust compiler security in zk-rollup environments.

---

## üõ°Ô∏è Immunefi's Security Insights

### Financial Impact of On-Chain Hacks

Mitchell Amador, CEO of Immunefi, recently highlighted the significant financial repercussions of on-chain hacks. He estimated that a typical protocol hack results in an average loss of ~$16 million, alongside a substantial decline in token value and a loss of user trust. Amador's insights emphasise the critical need for enhanced security measures in the DeFi space. He advocates for the adoption of comprehensive bug bounty programs and proactive security audits to mitigate risks and protect user assets.

My key takeaway from this is: if the average hack costs $16M and comprehensive security programs cost under $1M annually, the ROI on security investment is literally 16:1 before counting reputational damage.


**Sources:**

- [Aave Governance Post ‚Äì zkSync Activation Issue](https://governance.aave.com/t/bgd-aave-v3-zksync-activation-issue-report/18819?utm_source=substack&utm_medium=email)  
- [Mitchell Amador Twitter ‚Äì Financial Impact of On-Chain Hacks](https://x.com/MitchellAmador/status/1828110931718758690?utm_source=substack&utm_medium=email)  