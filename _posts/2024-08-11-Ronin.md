---
title: "Ronin's $12M Upgrade Fumble: How Skipping One Function Call Almost Cost Everything"
date: 2024-08-11
categories: [DeFi, Smart Contracts, Security, Ronin]
---

## üîç Overview

On 6 August the Ronin Network bridge was exploited, resulting in the unauthorised withdrawal of ~4,000 ETH and ~2 million USDC (totaling ~$12 million). This incident, referred to as "REKT II," was attributed to a critical oversight during a contract upgrade.


### The Upgrade

Ronin was upgrading their bridge manager from version 2 to version 4, skipping version 3 entirely. During deployment, they called `initializeV4()` but completely forgot about `initializeV3()`. This left a critical variable `_totalOperatorWeight` sitting at zero, which effectively disabled the `minimumVoteWeight` security check.

**What should have happened:**
```solidity
contract RoninBridgeV4 {
    uint256 private _totalOperatorWeight;
    uint256 public minimumVoteWeight;
    
    function initializeV3() external {
        // This never got called
        _totalOperatorWeight = calculateTotalWeight();
        minimumVoteWeight = (_totalOperatorWeight * 70) / 100; // 70% threshold
    }
    
    function initializeV4() external {
        // This got called, but depended on V3 being initialized first
        setupNewFeatures();
    }
}
```

**What actually happened**
```solidity
// _totalOperatorWeight = 0 (never initialized)
// minimumVoteWeight = 0 (calculated from uninitialized weight)

function validateWithdrawal(bytes[] calldata signatures) external {
    uint256 totalWeight = calculateSignatureWeight(signatures);
    
    // This check became meaningless
    require(totalWeight >= minimumVoteWeight, "Insufficient signatures");
    // 0 >= 0 = true (always passes)
}
```

The bridge essentially went from requiring validator consensus to accepting any withdrawal request without question.

### The Exploit

With security checks disabled, a MEV bot identified the vulnerability and front-ran any potential manual exploit attempts. The bot executed the attack, withdrawing the maximum single transaction limit of 4,000 ETH and 2 million USDC, directing the funds to its own address.

Thanks to a daily withdrawal limit, an additional $72 million was saved from being pilfered. The Ronin team managed to pause the contract about 38 minutes after the exploit began. In a surprising turn of events, the stolen funds were swiftly returned, thanks to lightning-fast MEV white hats who outpaced potential malicious actors. The ETH, valued at approximately $10 million, was promptly sent back to the Ronin team.

## üõ†Ô∏è Mitigation and Recommendations

In response to the incident, the Ronin team has taken the following actions:

- **Pause of Bridge Operations**: The bridge was paused to prevent further unauthorised withdrawals.

- **Return of Stolen Funds**: The stolen funds were promptly returned by white hat hackers.

- **Security Enhancements**: The team is reviewing and enhancing their upgrade processes to prevent similar oversights in the future.

To mitigate similar risks, the following best practices are recommended:

- **Thorough Testing**: Implement comprehensive testing procedures for all contract upgrades.

- **Security Audits**: Conduct regular security audits to identify and address potential vulnerabilities.

- **Upgrade Procedures**: Establish and follow strict procedures for contract upgrades, including thorough initialisation of all parameters.

## üß† Conclusion

The Ronin Network bridge exploit serves as a reminder of the critical importance of thorough testing and careful attention to detail during contract upgrades. While the immediate impact was contained, the incident underscores the need for robust security practices to safeguard user funds and maintain trust in the platform.

---

