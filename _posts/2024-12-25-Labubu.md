---
title: "Labubu, Haven Protocol, and Other Preventable DeFi Exploits"
date: 2024-12-25
categories: [DeFi, Smart Contract Security, Exploits, Analysis]
---

## Labubu â€“ $120K Exploit Due to Faulty Transfer Logic

### Incident Overview

Labubu lost $120,000 due to a bug in its `_transfer` function, which failed to handle transfers where the sender and recipient were identical....sigh.  

The vulnerability allowed attackers to double their assets on each deposit if they supplied the same source and destination address.

### Vulnerable Code Snippet

```solidity
function _transfer(address sender, address recipient, uint256 amount) internal {
    require(sender != address(0), "Xfer from zero addr");
    require(recipient != address(0), "Xfer to zero addr");

    uint256 senderBalance = _balances[sender];
    uint256 recipientBalance = _balances[recipient];

    uint256 newSenderBalance = SafeMath.sub(senderBalance, amount);
    if (newSenderBalance != senderBalance) {
        _balances[sender] = newSenderBalance;
    }
}
```

### Analysis

- The contract fails to properly handle `sender == recipient` transfers.  
- `SafeMath.sub` returns 0 if subtraction underflows, but the conditional  
  `if (newSenderBalance != senderBalance)` prevents correct updating, leaving balances inconsistent.  
- This allows asset duplication and can be compounded with liquidity pools, as seen with PancakeSwap liquidity exploited shortly after deployment.

### Timeline

- Exploited 9 hours post-deployment.  
- Attacker waited for sufficient PancakeSwap liquidity before executing.

---


## Alpaca Finance â€“ Price Oracle Exploit

- Loss occurred due to manual price updates from CoinGecko.  
- Exploit triggered when a token pumped on CeFi listings, highlighting the risk of manual oracles.  
- **Lesson:** Always use decentralised, tamper-resistant oracles for pricing data.

## Clober â€“ $500K Reentrancy

- **Post-audit code changes** introduced a reentrancy vulnerability.  
- **Lesson:** Code changes after audits require additional verification; audits alone are insufficient if post-audit updates bypass checks.

## Doge Chain â€“ Unpatched Vulnerability

- Exploit occurred from a **known bug** that most nodes failed to patch.  
- Resulted in hundreds of thousands lost unnecessarily.  

---

## Haven Protocol Shutdown â€“ Infinite Mint Exploit

### Background

- Haven Protocol, a Monero fork, announced its shutdown after an infinite minting vulnerability in its XHV token was confirmed.  
- **First signs detected:** August 2024 â€“ $10M xUSD burned beyond circulating supply.  
- **Confirmed control:** Attackers held 94% of supply, making recovery impossible.  
- **Historical context:** In June 2021, Haven lost $4.5M over 7 days from four separate minting exploits.

### Technical Analysis

- Infinite mint exploits are catastrophic because they break the tokenomics integrity of a chain.  
- Havenâ€™s failure to communicate with the broader ecosystem (like Zeph, which patched a similar vulnerability) contributed to its demise.  

**Required safeguards:**

- Cross-project collaboration on vulnerability patches  
- Timely audits and continuous monitoring  
- Immutable minting controls and supply caps

---

## ðŸ”‘ Lessons Learned

- **Smart Contract Logic:** Always test edge cases like `sender == recipient` and underflow/overflow conditions.  
- **Post-Audit Code Changes:** Any modifications after audit require re-review.  
- **Oracle Management:** Use decentralised, tamper-resistant oracles; avoid manual price feeds.  
- **Patch Management:** Timely updates across nodes prevent avoidable exploits.  
- **Cross-Project Knowledge Sharing:** Sharing vulnerability insights across projects can prevent repeat incidents.  
- **Critical Bug Response:** Infinite minting vulnerabilities are often irrecoverable; rapid detection and transparent disclosure are essential.

---

## ðŸ“š Sources

- [BlockThreat â€“ Labubu and Other DeFi Exploits](https://newsletter.blockthreat.io/p/blockthreat-week-34-2024?utm_source=substack&publication_id=8105&post_id=148591576&utm_medium=email&utm_content=share&utm_campaign=email-share&isFreemail=true&r=30d2a8)  
- [Alpaca Finance Oracle Hack Analysis](https://rekt.news/)  
- [Clober Post-Audit Exploit](https://rekt.news/)  
- [Haven Protocol Shutdown Announcement](https://medium.com/@cvg_wireshark/post-mortem-08-01-2024-e80a49d108a0)  

---