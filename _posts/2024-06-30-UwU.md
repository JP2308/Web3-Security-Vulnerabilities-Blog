---
title: "UwU Lend and Rushed Recovery Failures"
date: 2024-06-30
categories: [Security, Exchange Exploits, Oracle Manipulation]
---

## UwU Lend's $23M Oracle Catastrophe - The Dangers of Protocol Forking

UwU Lend suffered two devastating exploits totaling $23M due to dangerous modifications to AAVE's oracle system, causing cascading liquidations across the entire Curve ecosystem.

**The Vulnerable Code Modification:**

```solidity
// UwU's dangerous modification to AAVE's oracle system
contract sUSDePriceProviderBUniCatch {
    function _getUSDeFraxEMAInUSD() internal view returns (uint256, uint256) {
        uint256 price = uwuOracle.getAssetPrice(FRAX);
        
        // SAFE: Using EMA price
        return (
            FullMath.mulDiv(FRAX_POOL.price_oracle(0), price, 1e18),
            
            // DANGEROUS: Using spot price directly from Curve pool
            FullMath.mulDiv(FRAX_POOL.get_p(0), price, 1e18) // <-- NO NO NO!
        );
    }
    
    function getPrice() external view override returns (uint256) {
        (uint256[] memory prices, bool uniFail) = _getPrices(true);
        
        // Median calculation using SPOT PRICES from Curve pools
        uint256 median = uniFail ? (prices[5] + prices[6]) / 2 : prices[5];
        require(median > 0, 'Median is zero');
        
        return FullMath.mulDiv(median, sUSDeScalingFactor, 1e3);
    }
}
```

### The Timeline and key considerations:
Attackers manipulated these spot prices to:
1. Borrow assets at artificially discounted rates
2. Liquidate positions at premium prices
3. Generate almost $20M in profit

**The Expanded Timeline:**

**Phase 1: Initial Exploit**
- Attacker manipulates UwU's oracle using spot prices
- Steals $20M+ from the protocol

**Phase 2: Ecosystem Contagion**
- Stolen CRV were deposited to Curve Lend which as the price started dropping created a chain of soft and later hard liquidations
- Curve's founder's, Michael Egorov, $100M in loans on UwU, Curve Lend and others also started going through liquidation
- CRV lost almost half of its value
- Millions locked away as bad debt

**Phase 3: The Double-Tap**
- UwU hastily unpaused the protocol after "fixing" the issue
- Attacker still owned sUSDCe used in the first exploit. Once again the attacker targeted the protocol by using that collateral to steal another $3.7M

### The Solution
UwU relied on unsafe spot-price oracles. AAVE solved this years ago by building oracle fallbacks with Chainlink + internal safety nets. Here’s a minimalised version of what they should’ve had:

```solidity
// What UwU should have kept from AAVE
contract SafeAAVEOracle {
    function getAssetPrice(address asset) public view override returns (uint256) {
        IChainlinkAggregator source = assetsSources[asset];
        
        if (asset == BASE_CURRENCY) {
            return BASE_CURRENCY_UNIT;
        } else if (address(source) == address(0)) {
            // Safe fallback to tested oracle
            return _fallbackOracle.getAssetPrice(asset);
        } else {
            int256 price = IChainlinkAggregator(source).latestAnswer();
            if (price > 0) {
                return uint256(price);
            } else {
                // Fallback maintains security guarantees
                return _fallbackOracle.getAssetPrice(asset);
            }
        }
    }
}
```
---

## The Systemic Risk of Rushed Protocol Recovery

Multiple protocols this week demonstrated catastrophically poor incident response, with hasty "fixes" leading to immediate re-exploitation.

### Case Study: UwU's Fatal Rush to Reopen

The Timeline Disaster:
1. **Day 1:** $20M exploit discovered
2. **Day 2-3:** Hasty patches implemented
3. **Day 4:** Protocol unpaused without comprehensive audit  
4. **Day 4:** Immediate $3.7M re-exploitation using residual attack vector

My takeaway from this is that unpausing the protocol a few days after the hack is too rushed to properly audit and secure the protocol. The second hack could have been prevented.

### The Proper Incident Response Framework
So what should have happened? A proposed timelock when implementing the changes, such as:

```solidity
// Proper post-exploit recovery checklist
contract IncidentResponse {
    enum RecoveryPhase {
        EMERGENCY_PAUSE,    // Immediate halt
        INVESTIGATION,      // Forensic analysis
        REMEDIATION,        // Fix implementation  
        TESTING,           // Comprehensive audit
        GRADUAL_RESUMPTION // Phased restart
    }
    
    uint256 constant MIN_RECOVERY_TIME = 7 days;
    uint256 constant MIN_AUDIT_TIME = 3 days;
    
    function emergencyPause() external onlyEmergency {
        // Immediate halt of all operations
        _pauseAllOperations();
        
        // Lock all user funds in safety
        _enableWithdrawalsOnly();
        
        // Begin forensic timeline
        incidentTimestamp = block.timestamp;
        currentPhase = RecoveryPhase.EMERGENCY_PAUSE;
    }
    
    function initiateRecovery() external onlyAfterInvestigation {
        require(
            block.timestamp > incidentTimestamp + MIN_RECOVERY_TIME,
            "Insufficient investigation time"
        );
        
        require(
            externalAuditCompleted && 
            internalReviewCompleted &&
            communityReviewPeriod,
            "Recovery criteria not met"
        );
        
        // Gradual resumption with monitoring
        _enableLimitedOperations();
    }
}
```

### The Economic Cost of Impatience

Direct Costs:
- **UwU Double Exploit:** $23.7M total loss
- **Curve Ecosystem Damage:** $100M+ in liquidations

Indirect Costs:
- **Market Confidence:** Widespread sell-offs across affected tokens  
- **Insurance Premium Increases:** Higher costs for protocol coverage
- **User Trust Erosion:** Long-term adoption impact

---

## Conclusion

The UwU double exploit is a textbook reminder that in DeFi, speed is the enemy of safety. A hasty reopening without rigorous investigation, external audit, and phased resumption didn’t just fail to restore confidence — it compounded the damage.

In Web3, exploits don’t just hit a single protocol. They ripple across ecosystems, triggering liquidations, eroding market trust, and raising systemic risk for everyone plugged into shared collateral and liquidity.

The lesson is simple for me:
- Pause longer than you think you need
- Audit deeper than you think is necessary
- Restart more cautiously than feels comfortable

A protocol that reopens too soon isn’t “back online.” It’s just opening the door for the attacker to walk in again.